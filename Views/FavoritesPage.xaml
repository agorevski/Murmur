<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Murmur.App.ViewModels"
             xmlns:models="clr-namespace:Murmur.App.Models"
             x:Class="Murmur.App.Views.FavoritesPage"
             x:DataType="vm:FavoritesViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,*" Padding="20">
        <Label Grid.Row="0" 
               Text="My Mixes" 
               FontSize="28" 
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,0,0,20"/>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20">
                <VerticalStackLayout Spacing="10">
                    <Label Text="â­ Favorites" FontSize="20" FontAttributes="Bold"/>
                    
                    <Label Text="No favorite mixes yet!"
                           IsVisible="{Binding FavoriteMixes.Count, Converter={StaticResource IsZeroConverter}}"
                           TextColor="Gray"
                           HorizontalOptions="Center"
                           Margin="0,20"/>

                    <CollectionView ItemsSource="{Binding FavoriteMixes}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Mix">
                                <Frame BorderColor="Gold"
                                       Padding="15"
                                       Margin="0,5"
                                       CornerRadius="10"
                                       BackgroundColor="{AppThemeBinding Light=#FFFACD, Dark=#4B4B2C}">
                                    <Grid ColumnDefinitions="*,Auto,Auto">
                                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                                            <Label Text="{Binding Name}" 
                                                   FontSize="16" 
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding LastUsed, StringFormat='Last used: {0:MMM dd}'}" 
                                                   FontSize="12" 
                                                   TextColor="Gray"/>
                                        </VerticalStackLayout>
                                        <Button Grid.Column="1"
                                                Text="â–¶"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FavoritesViewModel}}, Path=PlayMixCommand}"
                                                CommandParameter="{Binding .}"
                                                WidthRequest="50"/>
                                        <Button Grid.Column="2"
                                                Text="ðŸ—‘"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FavoritesViewModel}}, Path=DeleteMixCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Crimson"
                                                WidthRequest="50"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="10">
                    <Label Text="All Mixes" FontSize="20" FontAttributes="Bold"/>
                    
                    <Label Text="No saved mixes yet! Create one in the Mixer tab."
                           IsVisible="{Binding Mixes.Count, Converter={StaticResource IsZeroConverter}}"
                           TextColor="Gray"
                           HorizontalOptions="Center"
                           Margin="0,20"/>

                    <CollectionView ItemsSource="{Binding Mixes}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Mix">
                                <Frame BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                                       Padding="15"
                                       Margin="0,5"
                                       CornerRadius="10">
                                    <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                                            <Label Text="{Binding Name}" 
                                                   FontSize="16" 
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding LastUsed, StringFormat='Last used: {0:MMM dd}'}" 
                                                   FontSize="12" 
                                                   TextColor="Gray"/>
                                        </VerticalStackLayout>
                                        <Button Grid.Column="1"
                                                Text="{Binding IsFavorite, Converter={StaticResource FavoriteIconConverter}}"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FavoritesViewModel}}, Path=ToggleFavoriteCommand}"
                                                CommandParameter="{Binding .}"
                                                WidthRequest="50"/>
                                        <Button Grid.Column="2"
                                                Text="â–¶"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FavoritesViewModel}}, Path=PlayMixCommand}"
                                                CommandParameter="{Binding .}"
                                                WidthRequest="50"/>
                                        <Button Grid.Column="3"
                                                Text="ðŸ—‘"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FavoritesViewModel}}, Path=DeleteMixCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Crimson"
                                                WidthRequest="50"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
